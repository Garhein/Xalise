// =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=- //
// Centre de notifications
// =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=- //

#xal-notification-center {
  --bs-offcanvas-width: 420px;

  @include media-breakpoint-down(md) {
    --bs-offcanvas-width: 100%;
  }

  .xal-notification-center__header {
    padding: .75rem 1rem;
    gap: .75rem;
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    color: var(--bs-body-color);
    background-color: var(--bs-body-bg);
    border-bottom: 1px solid var(--bs-border-color);

    &-meta {
      min-width: 0;
      gap: .25rem;
      display: flex;
      flex-direction: column;
    }

    &-title {
      gap: .5rem;
      display: flex;
      align-items: center;
      font-weight: 600;
      font-size: .95rem;
      line-height: 1.25;
      color: var(--bs-body-color);
    }

    &-subtitle {
      line-height: 1.2;
      font-size: .6875rem;
      color: var(--bs-secondary-color);
    }

    .badge {
      line-height: 1;
      font-weight: 500;
      font-size: .7rem;
      color: var(--bs-body-color);
      background-color: var(--bs-secondary-bg);
    }
  }

  .xal-notification-center__header-actions {
    gap: .25rem;
    display: flex;
    align-items: center;
  }

  .xal-notification-center__bulk-action {
    opacity: .75;
    padding: .25rem;
    min-width: 1.75rem;
    min-height: 1.75rem;
    align-items: center;
    border-radius: .5rem;
    display: inline-flex;
    justify-content: center;
    background-color: transparent;
    color: var(--bs-secondary-color);

    i {
      line-height: 1;
      font-size: .875rem;
    }

    &:hover,
    &:focus-visible {
      opacity: 1;
      transform: scale(1.04);
    }

    &--read,
    &--unread {
      &:hover,
      &:focus-visible {
        color: var(--bs-primary-text-emphasis);
        background-color: color-mix(in srgb, var(--bs-primary) 16%, var(--bs-body-bg));
      }

      &:focus-visible {
        box-shadow: 0 0 0 2px rgba(var(--bs-primary-rgb), .25);
      }
    }

    &--delete {
      &:hover,
      &:focus-visible {
        color: var(--bs-danger-text-emphasis);
        background-color: color-mix(in srgb, var(--bs-danger) 14%, var(--bs-body-bg));
      }

      &:focus-visible {
        box-shadow: 0 0 0 2px rgba(var(--bs-danger-rgb), .25);
      }
    }

    &--disabled {
      opacity: .4;
      pointer-events: none;
    }
  }

  .xal-notification-center__bulk-confirm {
    padding: .75rem 1rem;
    background: var(--bs-body-bg);
    border-bottom: 1px solid var(--bs-border-color);

    button {
      font-size: .75rem;
    }
  }

  .offcanvas-body {
    display: flex;
    flex-direction: column;
  }

  .xal-notification-center__list {
    margin: 0;
    padding: 0;
    flex: 1 1 auto;
    list-style: none;
    overflow-y: auto;

    &.xal-notification-center__list--busy {
      opacity: .6;
      pointer-events: none;
    }
  }

  .xal-notification-center__list-empty {
    padding: 1rem;
    text-align: center;
    color: var(--bs-secondary-color);
    background-color: var(--bs-tertiary-bg);
    border-bottom: 1px solid var(--bs-border-color);

    i {
      opacity: .5;
      font-size: 1.25rem;
    }
  }

  .xal-notification[data-xal-notification] {
    padding: 0;
    line-height: normal;
    border-bottom: 1px solid var(--bs-border-color);

    &.xal-notification--read {
      .xal-notification__dot {
        opacity: .25;
        background-color: var(--bs-secondary-text-emphasis);
      }

      .xal-notification__action--mark-read {
        display: none;
      }
    }

    &.xal-notification--unread {
      border-left: 4px solid var(--bs-primary);

      .xal-notification__link {
        background-color: color-mix(in srgb, var(--bs-primary-bg-subtle) 55%, var(--bs-body-bg));

        &:hover,
        &:focus-visible {
          background-color: var(--bs-secondary-bg);
        }
      }

      .xal-notification__action--mark-unread {
        display: none;
      }
    }

    &.xal-notification--busy {
      opacity: .6;
      cursor: progress;
      pointer-events: none;

      .xal-notification__spinner {
        display: inline-flex;
      }

      .xal-notification__actions {
        opacity: 0;
        visibility: hidden;
      }

      .xal-notification__link {
        pointer-events: none;
      }
    }
  
    &:not(.xal-notification--busy):hover .xal-notification__dot {
      transform: scale(1.1);
    }
  
    &:not(.xal-notification--busy) .xal-notification__link:hover .xal-notification__actions,
    &:not(.xal-notification--busy) .xal-notification__link:focus-within .xal-notification__actions {
        opacity: 1;
        visibility: visible;
        pointer-events: auto;
        transform: translateX(0) translateY(-50%) scale(1);
    }
  }

  .xal-notification__link {
    display: block;
    color: inherit;
    position: relative;
    padding: .5rem .75rem;
    text-decoration: none;
    border-radius: inherit;

    &:hover,
    &:focus-visible {
      background-color: var(--bs-tertiary-bg);

      .xal-notification__content {
        text-decoration: underline;
        text-underline-offset: 2px;
        text-decoration-thickness: 1px;
      }
    }

    &:focus-visible {
      outline-offset: 2px;
      outline: 2px solid var(--bs-primary);
      box-shadow: inset 0 0 0 1px var(--bs-border-color);
    }
  }

  .xal-notification__body {
    display: grid;
    row-gap: .125rem;
    column-gap: .5rem;
    align-items: center;
    padding-right: 2.5rem;
    grid-template-columns: .875rem .875rem 1fr;

    .xal-notification__dot {
      width: .8rem;
      height: .8rem;
      border-radius: 50%;
      background-color: var(--bs-primary);
    }

    .bi {
      line-height: 1;
      flex-shrink: 0;
      font-size: .875rem;
    }

    .xal-notification__content {
      display: flex;
      overflow: hidden;
      line-height: 1.5;
      font-size: .875rem;
      align-items: center;
      white-space: nowrap;
      text-overflow: ellipsis;
    }

    .xal-notification__time {
      grid-column: 3;
      line-height: 1.2;
      font-size: .75rem;
      color: var(--bs-secondary-color);
    }

    .xal-notification__spinner {
      top: 50%;
      right: .75rem;
      display: none;
      position: absolute;
      pointer-events: none;
      transform: translateY(-50%);
    }
  }

  .xal-notification__actions {
    top: 50%;
    opacity: 0;
    gap: .25rem;
    right: .5rem;
    display: flex;
    visibility: hidden;
    position: absolute;
    pointer-events: none;
    will-change: opacity, transform;

    .btn {
      opacity: .7;
      line-height: 1;
      padding: .25rem;
      min-width: 1.75rem;
      align-items: center;
      min-height: 1.75rem;
      border-radius: .5rem;
      display: inline-flex;
      justify-content: center;
      background-color: transparent;
      color: var(--bs-secondary-color);

      &:hover,
      &:focus-visible {
        opacity: 1;
        visibility: visible;
        transform: scale(1.04);
        color: var(--bs-primary-text-emphasis);
        background-color: color-mix(in srgb, var(--bs-primary) 14%, var(--bs-body-bg));
      }

      &:focus-visible {
        outline: none;
        box-shadow: 0 0 0 2px rgba(var(--bs-primary-rgb), .25);
      }
    }

    // &:has(.is-busy) {
    //   opacity: 1;
    //   visibility: visible;
    // }
  }

  .xal-notification-center__footer {
    padding: .75rem 1rem;
    background-color: var(--bs-primary);
    border-top: 1px solid rgba(var(--bs-primary-rgb), .35);

    .btn {
      gap: .4rem;
      width: 100%;
      align-items: center;
      display: inline-flex;
      justify-content: center;
      color: var(--bs-secondary-text-emphasis);
      background-color: color-mix(in srgb, var(--bs-white) 50%, var(--bs-primary));

      i {
        line-height: 1;
        font-size: .9rem;
      }

      &:hover,
      &:focus-visible {
        color: var(--bs-white);
      }

      &:focus-visible {
        outline: none;
        box-shadow: 0 0 0 2px rgba(255, 255, 255, .5);
      }
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .xal-notification__actions,
    .xal-notification__actions .btn {
      transition: none;
      transform: translateY(-50%);
    }
  }
}

// =-=-=-=-=-=-
// Suppression unitaire
// Barre de progression synchronisée avec le délai autorisé pour la suppression
// =-=-=-=-=-=-

.xal-notification-toast__progress {
  height: 2px;
  display: block;
  margin-top: .25rem;
  transform-origin: left;
  background-color: $xalise-color;
  animation: xal-notification-toast-progress var(--toast-duration, 0ms) linear forwards;
}

@keyframes xal-notification-toast-progress {
  from { transform: scaleX(1); }
  to   { transform: scaleX(0); }
}